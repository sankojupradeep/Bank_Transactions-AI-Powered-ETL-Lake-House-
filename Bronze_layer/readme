# ðŸ¦ Bronze Layer â€” Incremental Ingestion (Delta Lake)

**Project:** Financial Transactions Lakehouse â€” Bronze layer  
**Script:** `bronze_delta_ingestion_incremental.py`  
**Purpose:** Incrementally ingest raw CSV files from S3/MinIO into Delta tables (Bronze layer) with checkpoints and logging.

---

## âœ… What this does

- ðŸ“¥ Reads raw CSVs from **S3/MinIO** (`transactions`, `customers`, `accounts`, `merchants`)  
- ðŸ”„ Performs **incremental ingestion** (only new rows since the last load) using timestamp columns  
- ðŸ’¾ Writes data as **Delta Lake** tables with checkpointing  
- ðŸ“Š Emits logs for monitoring (Grafana/Log collector friendly)  
- ðŸ—ï¸ Forms the **first step of the ETL lakehouse**: `Raw â†’ Bronze â†’ Silver â†’ Gold`  

---

## ðŸ”§ Tech Stack

- âš¡ **Apache Spark (PySpark)** â€” tested with Spark **4.0.1**  
- ðŸŸ¢ **Delta Lake** (`delta-spark` / delta Python package)  
- ðŸ“¦ **MinIO (S3 API)** â€” local object store for raw/bronze data  
- ðŸ› ï¸ **Hadoop S3A connector** (`hadoop-aws`) + **AWS SDK** (`aws-java-sdk-bundle`) JARs  
- ðŸ **Python 3.8+** (tested on 3.12 â€” works if dependencies are compatible)  
- ðŸ“Œ *(Optional)* Airflow for orchestration, Streamlit/Plotly for dashboards  

---

## ðŸ“ Tables Managed

- ðŸ§¾ **transactions** â†’ ingested incrementally via `timestamp`  
- ðŸ‘¥ **customers** â†’ ingested incrementally via `created_at`  
- ðŸ’³ **accounts** â†’ ingested incrementally via `opened_date`  
- ðŸ¬ **merchants** â†’ append-only (no timestamp column)  

---

## â–¶ How it Works

1. The script reads raw CSVs from the `raw/` folder in **S3 (MinIO)**.  
2. For tables with a timestamp column:
   - Compares with the **max timestamp in Delta table**  
   - Loads only rows **newer than the last ingested row**  
3. Writes to **Bronze Delta tables** under `s3a://bucket/bronze/...`  
4. Maintains **checkpoints** for resilience and recovery.  
5. Logs ingestion stats for monitoring and auditing.  

---

## ðŸ“‚ Data Flow

```mermaid
flowchart TD
    A[Raw CSVs on MinIO] -->|Read with Spark| B[Bronze Layer - Delta Tables]
    B -->|Checkpointing| C[Delta Checkpoints]
    B -->|Next Stage| D[Silver Layer]
